<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Encrypting Partitions using LUKS &mdash; kpj&#39;s blog 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=d45e8c67"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Building a Custom Linux Kernel" href="KernelBuilding.html" />
    <link rel="prev" title="Connecting to Eduroam Network" href="Eduroam.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            kpj's blog
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Linux</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ConfigureFreshArchlinuxInstall.html">Configuring a fresh Archlinux Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="Eduroam.html">Connecting to Eduroam Network</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Encrypting Partitions using LUKS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#before-you-start">Before you start</a></li>
<li class="toctree-l2"><a class="reference internal" href="#getting-started-with-encrypting">Getting started with encrypting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#accessing-the-encrypted-partition">Accessing the encrypted partition</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unmounting-the-encrypted-partition">Unmounting the encrypted partition</a></li>
<li class="toctree-l2"><a class="reference internal" href="#normal-workflow">Normal Workflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="KernelBuilding.html">Building a Custom Linux Kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="MediaServerSetup.html">Setting up a media server</a></li>
<li class="toctree-l1"><a class="reference internal" href="MonitoringWithMunin.html">Monitoring server resources using Munin</a></li>
<li class="toctree-l1"><a class="reference internal" href="RescuingABrokenSystem.html">Rescuing a Broken Archlinux System</a></li>
<li class="toctree-l1"><a class="reference internal" href="SetupEncryptedArchlinux.html">Setting up Archlinux with Encrypted Disk</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Mining &amp; Visualization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../mining_visualization/ArtOfLife.html">The Art of Life</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mining_visualization/Eurostat_Visualizations.html">Visualizing Eurostat data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mining_visualization/IMDB_ratings.html">Investigating TV Series ratings using IMDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mining_visualization/MEP_Statistics.html">Analyzing the European Parliament</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mining_visualization/ProjectWordcloud.html">Creating a Wordcloud of Your (Work) Life</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mining_visualization/SortingAnimations.html">Visualizing Sorting Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mining_visualization/SwissMountainProfiles.html">Visualizing Height Profiles of Swiss Mountains</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Statistics &amp; Machine Learning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../stats_ml/Autoencoder.html">Playing with Variational Autoencoders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stats_ml/LinearRegressionCoefficients.html">Interpreting the coefficients of a linear regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stats_ml/ProbabilityDistributionsOverview.html">The Daring Landscape of Probability Distribution Functions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/BenchmarkingCommonOperations.html">Benchmarking common operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/InterceptingHTTPTraffic.html">Intercepting HTTP(S) Traffic of Android Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/PythonAlmanac.html">The Python Almanac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/ThreadingVSMultiprocessing.html">Comparing threading and multiprocessing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">OSS Projects</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../my_projects/bin2fasta.html">bin2fasta: Store any file as a fasta file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../my_projects/clypper.html">clypper: Rapidly create supercuts from various video sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../my_projects/cookiecutter-python.html">cookiecutter-python: An opinionated template for Python packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../my_projects/gitviz.html">GitViz: Visualize the evolution of a git repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="../my_projects/ipy_pdcache.html">ipy_pdcache: Automatically cache results of intensive computations in IPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../my_projects/jupyfmt.html">jupyfmt: The uncompromising Jupyter notebook formatter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../my_projects/metagenompy.html">metagenompy: The NCBI taxonomy as a NetworkX graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../my_projects/pdftty.html">pdftty: A PDF viewer for the terminal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../my_projects/plyder.html">plyder: Download Manager with Web-Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../my_projects/pyskim.html">pyskim: Quick summary statistics for dataframes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../my_projects/rwrap.html">rwrap: Seamlessly integrate R packages into Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../my_projects/vydia.html">Vydia: A modularized video player</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Scientific Work</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../science/presentations.html">Presentations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../science/publications.html">Publications</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">kpj's blog</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Encrypting Partitions using LUKS</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/linux/EncryptPartitions.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="encrypting-partitions-using-luks">
<h1>Encrypting Partitions using LUKS<a class="headerlink" href="#encrypting-partitions-using-luks" title="Link to this heading"></a></h1>
<section id="before-you-start">
<h2>Before you start<a class="headerlink" href="#before-you-start" title="Link to this heading"></a></h2>
<p>You might want to format your device as the first step, but this is only optional.
More important is to create a proper partition layout on your device, namely a small one to store some meta information and a larger one to store the actual data.</p>
<p>In the following I am going to assume that the matching block device is <code class="docutils literal notranslate"><span class="pre">/dev/sdb</span></code> (you can find yours using e.g. ‘lsblk’).
In order to create the two partitions fire up ‘fdisk’ and create a new partition table</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>fdisk<span class="w"> </span>/dev/sdb

Command<span class="w"> </span><span class="o">(</span>m<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">help</span><span class="o">)</span>:<span class="w"> </span>g
Created<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>GPT<span class="w"> </span>disklabel<span class="w"> </span><span class="o">(</span>GUID:<span class="w"> </span><span class="o">[</span>..<span class="o">])</span>.

Command<span class="w"> </span><span class="o">(</span>m<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">help</span><span class="o">)</span>:<span class="w"> </span>w
The<span class="w"> </span>partition<span class="w"> </span>table<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>altered.
Calling<span class="w"> </span>ioctl<span class="o">()</span><span class="w"> </span>to<span class="w"> </span>re-read<span class="w"> </span>partition<span class="w"> </span>table.
Syncing<span class="w"> </span>disks.
</pre></div>
</div>
<p>In the next step, we are going to add the two new partitions. One of size 5M (to store meta data) and one to span the rest. We can thus take the default value for all but the last sector of the first partition.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>fdisk<span class="w"> </span>/dev/sdb

Command<span class="w"> </span><span class="o">(</span>m<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">help</span><span class="o">)</span>:<span class="w"> </span>n
Partition<span class="w"> </span>number<span class="w"> </span><span class="o">(</span><span class="m">1</span>-128,<span class="w"> </span>default<span class="w"> </span><span class="m">1</span><span class="o">)</span>:
First<span class="w"> </span>sector<span class="w"> </span><span class="o">(</span><span class="m">2048</span>-15667166,<span class="w"> </span>default<span class="w"> </span><span class="m">2048</span><span class="o">)</span>:
Last<span class="w"> </span>sector,<span class="w"> </span>+sectors<span class="w"> </span>or<span class="w"> </span>+size<span class="o">{</span>K,M,G,T,P<span class="o">}</span><span class="w"> </span><span class="o">(</span><span class="m">2048</span>-15667166,<span class="w"> </span>default<span class="w"> </span><span class="m">15667166</span><span class="o">)</span>:<span class="w"> </span>+5M

Command<span class="w"> </span><span class="o">(</span>m<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">help</span><span class="o">)</span>:<span class="w"> </span>n
Partition<span class="w"> </span>number<span class="w"> </span><span class="o">(</span><span class="m">2</span>-128,<span class="w"> </span>default<span class="w"> </span><span class="m">2</span><span class="o">)</span>:
First<span class="w"> </span>sector<span class="w"> </span><span class="o">(</span><span class="m">12288</span>-15667166,<span class="w"> </span>default<span class="w"> </span><span class="m">12288</span><span class="o">)</span>:
Last<span class="w"> </span>sector,<span class="w"> </span>+sectors<span class="w"> </span>or<span class="w"> </span>+size<span class="o">{</span>K,M,G,T,P<span class="o">}</span><span class="w"> </span><span class="o">(</span><span class="m">12288</span>-15667166,<span class="w"> </span>default<span class="w"> </span><span class="m">15667166</span><span class="o">)</span>:
</pre></div>
</div>
<p>Print the partition table to make sure everything worked out</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Command<span class="w"> </span><span class="o">(</span>m<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">help</span><span class="o">)</span>:<span class="w"> </span>p
Disk<span class="w"> </span>/dev/sdb:<span class="w"> </span><span class="m">7</span>.5<span class="w"> </span>GiB,<span class="w"> </span><span class="m">8021606400</span><span class="w"> </span>bytes,<span class="w"> </span><span class="m">15667200</span><span class="w"> </span>sectors
Units:<span class="w"> </span>sectors<span class="w"> </span>of<span class="w"> </span><span class="m">1</span><span class="w"> </span>*<span class="w"> </span><span class="nv">512</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">512</span><span class="w"> </span>bytes
Sector<span class="w"> </span>size<span class="w"> </span><span class="o">(</span>logical/physical<span class="o">)</span>:<span class="w"> </span><span class="m">512</span><span class="w"> </span>bytes<span class="w"> </span>/<span class="w"> </span><span class="m">512</span><span class="w"> </span>bytes
I/O<span class="w"> </span>size<span class="w"> </span><span class="o">(</span>minimum/optimal<span class="o">)</span>:<span class="w"> </span><span class="m">512</span><span class="w"> </span>bytes<span class="w"> </span>/<span class="w"> </span><span class="m">512</span><span class="w"> </span>bytes
Disklabel<span class="w"> </span>type:<span class="w"> </span>gpt
Disk<span class="w"> </span>identifier:<span class="w"> </span><span class="o">[</span>..<span class="o">]</span>

Device<span class="w">     </span>Start<span class="w">      </span>End<span class="w">  </span>Sectors<span class="w">  </span>Size<span class="w"> </span>Type
/dev/sdb1<span class="w">   </span><span class="m">2048</span><span class="w">    </span><span class="m">12287</span><span class="w">    </span><span class="m">10240</span><span class="w">    </span>5M<span class="w"> </span>Linux<span class="w"> </span>filesystem
/dev/sdb2<span class="w">  </span><span class="m">12288</span><span class="w"> </span><span class="m">15667166</span><span class="w"> </span><span class="m">15654879</span><span class="w">  </span><span class="m">7</span>.5G<span class="w"> </span>Linux<span class="w"> </span>filesystem
</pre></div>
</div>
<p>and save your changes</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Command<span class="w"> </span><span class="o">(</span>m<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">help</span><span class="o">)</span>:<span class="w"> </span>w
The<span class="w"> </span>partition<span class="w"> </span>table<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>altered.
Calling<span class="w"> </span>ioctl<span class="o">()</span><span class="w"> </span>to<span class="w"> </span>re-read<span class="w"> </span>partition<span class="w"> </span>table.
Syncing<span class="w"> </span>disks.
</pre></div>
</div>
<p>Executing <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">/dev/sdb*</span></code> will now reveal the two new block devices <code class="docutils literal notranslate"><span class="pre">/dev/sdb1</span></code> and <code class="docutils literal notranslate"><span class="pre">/dev/sdb2</span></code>.
As the first one will store helpful information it is formatted to ext4 using ‘mke2fs’ (<code class="docutils literal notranslate"><span class="pre">-L</span></code> will set the volume label).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>mke2fs<span class="w"> </span>-L<span class="w"> </span>sticky-hint<span class="w"> </span>-t<span class="w"> </span>ext4<span class="w"> </span>/dev/sdb1
Creating<span class="w"> </span>filesystem<span class="w"> </span>with<span class="w"> </span><span class="m">5120</span><span class="w"> </span>1k<span class="w"> </span>blocks<span class="w"> </span>and<span class="w"> </span><span class="m">1280</span><span class="w"> </span>inodes

Allocating<span class="w"> </span>group<span class="w"> </span>tables:<span class="w"> </span><span class="k">done</span><span class="w">                            </span>
Writing<span class="w"> </span>inode<span class="w"> </span>tables:<span class="w"> </span><span class="k">done</span><span class="w">                            </span>
Writing<span class="w"> </span>superblocks<span class="w"> </span>and<span class="w"> </span>filesystem<span class="w"> </span>accounting<span class="w"> </span>information:<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<p>Useful information about our partitions can then be stored as follows</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>mount<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/
$<span class="w"> </span>fdisk<span class="w"> </span>-l<span class="w"> </span>/dev/sdb<span class="w"> </span>&gt;<span class="w"> </span>/mnt/partitions
$<span class="w"> </span>umount<span class="w"> </span>/mnt
</pre></div>
</div>
</section>
<section id="getting-started-with-encrypting">
<h2>Getting started with encrypting<a class="headerlink" href="#getting-started-with-encrypting" title="Link to this heading"></a></h2>
<p>In the following, <a class="reference external" href="http://en.wikipedia.org/wiki/Linux_Unified_Key_Setup">LUKS</a> is used as it offers a metadata header.
This can be done by using the ‘cryptsetup’ tool. If you want to use an extra long passphrase, a key file can be used with the <code class="docutils literal notranslate"><span class="pre">--key-file</span> <span class="pre">&lt;file&gt;</span></code> parameter. For the sake of simplicity I am going to provide a password from stdin here.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cryptsetup<span class="w"> </span>-v<span class="w"> </span>luksFormat<span class="w"> </span>/dev/sdb2

WARNING!
<span class="o">========</span>
This<span class="w"> </span>will<span class="w"> </span>overwrite<span class="w"> </span>data<span class="w"> </span>on<span class="w"> </span>/dev/sdb2<span class="w"> </span>irrevocably.

Are<span class="w"> </span>you<span class="w"> </span>sure?<span class="w"> </span><span class="o">(</span>Type<span class="w"> </span>uppercase<span class="w"> </span>yes<span class="o">)</span>:<span class="w"> </span>YES
Enter<span class="w"> </span>passphrase:
Verify<span class="w"> </span>passphrase:
Command<span class="w"> </span>successful.
</pre></div>
</div>
<p>The header and keyslot area can then be backuped (assuming that the meta info partition is still mounted as before)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cryptsetup<span class="w"> </span>luksHeaderBackup<span class="w"> </span>/dev/sdb2<span class="w"> </span>--header-backup-file<span class="w"> </span>/mnt/header
</pre></div>
</div>
</section>
<section id="accessing-the-encrypted-partition">
<h2>Accessing the encrypted partition<a class="headerlink" href="#accessing-the-encrypted-partition" title="Link to this heading"></a></h2>
<p>We can open our newly create drive which is backed by <code class="docutils literal notranslate"><span class="pre">/dev/sdb2</span></code> by executing</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cryptsetup<span class="w"> </span>-v<span class="w"> </span>luksOpen<span class="w"> </span>/dev/sdb2<span class="w"> </span>sticky
Enter<span class="w"> </span>passphrase<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/sdb2:
Key<span class="w"> </span>slot<span class="w"> </span><span class="m">0</span><span class="w"> </span>unlocked.
Command<span class="w"> </span>successful.
</pre></div>
</div>
<p>This command is going to create a mapping in <code class="docutils literal notranslate"><span class="pre">/dev/mapper</span></code> called ‘sticky’, which we can use to access our partition.
Right now, we obviously cannot use it since there is no filesystem on it. Let’s change that.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>mke2fs<span class="w"> </span>-L<span class="w"> </span>sticky<span class="w"> </span>-t<span class="w"> </span>ext4<span class="w"> </span>/dev/mapper/sticky
Creating<span class="w"> </span>filesystem<span class="w"> </span>with<span class="w"> </span><span class="m">1956347</span><span class="w"> </span>4k<span class="w"> </span>blocks<span class="w"> </span>and<span class="w"> </span><span class="m">489600</span><span class="w"> </span>inodes
Filesystem<span class="w"> </span>UUID:<span class="w"> </span>57d5effc-7d34-4866-aa5c-3a1a95c04f81
Superblock<span class="w"> </span>backups<span class="w"> </span>stored<span class="w"> </span>on<span class="w"> </span>blocks:
<span class="w">    </span><span class="m">32768</span>,<span class="w"> </span><span class="m">98304</span>,<span class="w"> </span><span class="m">163840</span>,<span class="w"> </span><span class="m">229376</span>,<span class="w"> </span><span class="m">294912</span>,<span class="w"> </span><span class="m">819200</span>,<span class="w"> </span><span class="m">884736</span>,<span class="w"> </span><span class="m">1605632</span>

Allocating<span class="w"> </span>group<span class="w"> </span>tables:<span class="w"> </span><span class="k">done</span><span class="w">                            </span>
Writing<span class="w"> </span>inode<span class="w"> </span>tables:<span class="w"> </span><span class="k">done</span><span class="w">                            </span>
Creating<span class="w"> </span>journal<span class="w"> </span><span class="o">(</span><span class="m">32768</span><span class="w"> </span>blocks<span class="o">)</span>:<span class="w"> </span><span class="k">done</span>
Writing<span class="w"> </span>superblocks<span class="w"> </span>and<span class="w"> </span>filesystem<span class="w"> </span>accounting<span class="w"> </span>information:<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<p>To be extra secure, its output can be saved to the hint partition as well.
The encrypted partition can then be mounted and subsequently used by executing</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>mount<span class="w"> </span>/dev/mapper/sticky<span class="w"> </span>/mnt/
</pre></div>
</div>
</section>
<section id="unmounting-the-encrypted-partition">
<h2>Unmounting the encrypted partition<a class="headerlink" href="#unmounting-the-encrypted-partition" title="Link to this heading"></a></h2>
<p>The device mounted through the mapping can be unmounted by simply using</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>umount<span class="w"> </span>/mnt
</pre></div>
</div>
<p>In order to remove the mapping another call to ‘cryptsetup’ is necessary</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cryptsetup<span class="w"> </span>-v<span class="w"> </span>luksClose<span class="w"> </span>sticky
Command<span class="w"> </span>successful.
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">sticky</span></code> is simply the name of the mapping.</p>
</section>
<section id="normal-workflow">
<h2>Normal Workflow<a class="headerlink" href="#normal-workflow" title="Link to this heading"></a></h2>
<p>To wrap everything up, this is the usual order of commands when using a device encrypted as described before</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cryptsetup<span class="w"> </span>-v<span class="w"> </span>luksOpen<span class="w"> </span>&lt;block<span class="w"> </span>device&gt;<span class="w"> </span>&lt;map<span class="w"> </span>name&gt;
$<span class="w"> </span>mount<span class="w"> </span>/dev/mapper/&lt;map<span class="w"> </span>name&gt;<span class="w"> </span>&lt;mount<span class="w"> </span>point&gt;
$<span class="w"> </span><span class="c1"># do work...</span>
$<span class="w"> </span>umount<span class="w"> </span>&lt;mount<span class="w"> </span>point&gt;
$<span class="w"> </span>cryptsetup<span class="w"> </span>-v<span class="w"> </span>luksClose<span class="w"> </span>&lt;map<span class="w"> </span>name&gt;
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Eduroam.html" class="btn btn-neutral float-left" title="Connecting to Eduroam Network" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="KernelBuilding.html" class="btn btn-neutral float-right" title="Building a Custom Linux Kernel" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, kpj.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>